/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java project to get you started.
 * For more details take a look at the Java Quickstart chapter in the Gradle
 * User Manual available at https://docs.gradle.org/6.6.1/userguide/tutorial_java_projects.html
 */

plugins {
    id 'java'
	id 'java-library'
    id 'application'
	//id 'org.javamodularity.moduleplugin' version '1.5.0' apply false
  	id "org.openjfx.javafxplugin" version "0.0.7"
    id 'org.beryx.jlink' version '2.22.0'  //optional for jlink

}

group 'com.sharedtable'
version '1.0-SNAPSHOT'

compileJava.options.encoding = "UTF-8"
compileTestJava.options.encoding = "UTF-8"

javafx {
    modules = [ 'javafx.controls','javafx.fxml', 'javafx.swing','javafx.web']
    version = '14.0.1'
}

java {
    //modularity.inferModulePath = true
	sourceCompatibility = JavaVersion.VERSION_14
	targetCompatibility = JavaVersion.VERSION_14
}


jlink {
    options = ['--strip-debug', '--compress', '2', '--no-header-files', '--no-man-pages']
    launcher{
        name = 'sharedtable'
		jvmArgs = ['-Dfile.encoding=UTF8']
    }
}



repositories {
    // Use jcenter for resolving dependencies.
    // You can declare any Maven/Ivy/file repository here.
    mavenCentral()
    flatDir {
        dirs '/libs'
    }
}
////////////////////////////////////////////////////////////////////////////////
dependencies {
    implementation 'com.google.guava:guava:29.0-jre'
    implementation files('libs/WaifUPnP.jar')
    implementation files('libs/jsonsimple.jar')

	testImplementation'org.junit.jupiter:junit-jupiter-api:5.7.0-M1'
	testImplementation 'org.junit.jupiter:junit-jupiter-engine:5.7.0-M1'
}

test {
	// Use junit platform for unit tests
	useJUnitPlatform()
	moduleOptions {
		runOnClasspath = true
	}

	testLogging {
		showStandardStreams = true
	}

}

////////////////////////////////////////////////////////////////////////////////

application {
    // Define the main class for the application.
    mainClassName = 'com.sharedtable.controller.MainViewController'
    mainModule = "sharedtable"
}

tasks.register("make_deb") {
	dependsOn 'build'
	dependsOn 'jlink'
	doLast {
		delete fileTree("deb_release/sharedtable/opt")
		copy{
		    from "addFilesToDeb"
		    into "deb_release/sharedtable/opt/sharedtable"
		}
		copy{
		    from "build/image"
		    exclude '**/legal/**'
		    into "deb_release/sharedtable/opt/sharedtable"

		}
		exec {
		    executable 'dpkg-deb'
		    args '--build','deb_release/sharedtable'
		}
	}
    
}

task make_installer(type:Exec) {
	
	dependsOn 'build'
	dependsOn 'jlink'
	commandLine 'C:\\Program Files (x86)\\NSIS\\makensis.exe', 'nsisOutput\\SharedTableInstaller.nsi'	
}

task tarz(type: Tar) {
 	doFirst{
 		copy{
			from "addFilesToDeb"
			into "build/image"
		}
	}

 	archiveName = 'SharedTablePortable.tar'
 	into ('/SharedTable'){
    	from 'build/image'
 	}


	destinationDir  file('tarOut')
	extension 'tar'
	compression = Compression.GZIP
}

task zip(type: Zip) {
 	doFirst{
 		copy{
			from "addFilesToZip"
			into "build/image/bin"
		}
	}

 	archiveName = 'SharedTablePortable.zip'
 	into ('/SharedTable'){
    	from 'build/image'
 	}


	destinationDir  file('zipOut')
	extension 'zip'
}


